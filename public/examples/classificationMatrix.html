<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>CogniKit - Classification Matrix Demo</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: system-ui, -apple-system, sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			padding: 2rem;
		}

		.demo-container {
			max-width: 1200px;
			margin: 0 auto;
		}

		.page-header {
			text-align: center;
			color: white;
			margin-bottom: 2rem;
		}

		.page-header h1 {
			font-size: 2.5rem;
			margin-bottom: 0.5rem;
			text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
		}

		.page-header p {
			font-size: 1.1rem;
			opacity: 0.9;
		}

		#quiz-mount {
			background: white;
			padding: 2rem;
			border-radius: 12px;
			box-shadow: 0 10px 30px rgba(0,0,0,0.3);
		}

		.info-box {
			margin-top: 2rem;
			padding: 1.5rem;
			background: rgba(255, 255, 255, 0.95);
			border-radius: 8px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.15);
		}

		.info-box h3 {
			color: #667eea;
			margin-bottom: 0.75rem;
		}

		.info-box ul {
			list-style-position: inside;
			color: #374151;
			line-height: 1.8;
		}

		.info-box li {
			margin-bottom: 0.5rem;
		}

		.code-box {
			background: #1e293b;
			color: #e2e8f0;
			padding: 1rem;
			border-radius: 6px;
			margin: 1rem 0;
			font-family: 'Courier New', monospace;
			font-size: 0.9rem;
			overflow-x: auto;
		}

		.features {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
			gap: 1rem;
			margin-top: 2rem;
		}

		.feature-card {
			background: rgba(255, 255, 255, 0.95);
			padding: 1.25rem;
			border-radius: 8px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
		}

		.feature-card h4 {
			color: #667eea;
			margin-bottom: 0.5rem;
			font-size: 1.1rem;
		}

		.feature-card p {
			color: #6b7280;
			font-size: 0.95rem;
			line-height: 1.5;
		}

		.feature-card label {
			display: block;
			margin-bottom: 0.5rem;
			font-weight: 600;
			color: #374151;
		}

		.feature-card select,
		.feature-card input[type="color"] {
			width: 100%;
			padding: 0.5rem;
			border: 2px solid #e5e7eb;
			border-radius: 6px;
			font-size: 0.95rem;
		}

		.feature-card input[type="color"] {
			height: 40px;
			cursor: pointer;
		}
	</style>
</head>
<body>
	<div class="demo-container">
		<div class="page-header">
			<h1>CogniKit Classification Matrix</h1>
			<p>Check boxes to assign multiple attributes to programming languages</p>
		</div>

		<div id="quiz-mount"></div>

		<div class="info-box">
			<h3>How to use this interaction:</h3>
			<ul>
				<li><strong>Step 1:</strong> Read each programming language in the rows</li>
				<li><strong>Step 2:</strong> Check the boxes for features each language has</li>
				<li><strong>Step 3:</strong> Multiple boxes can be checked per row (languages can have multiple features)</li>
				<li><strong>Step 4:</strong> Progress bar updates as you complete each row</li>
				<li><strong>Step 5:</strong> Once all rows have at least one selection, click "Check" to see your score</li>
				<li><strong>Grading:</strong> Partial credit given - each cell is graded independently</li>
			</ul>
		</div>

		<div class="info-box">
			<h3>DSL Code (Mini-Language):</h3>
			<div class="code-box">INTERPRETED = Python | JavaScript | Ruby;<br>COMPILED = Rust | C | Go | Java;<br>STRONGLY_TYPED = Rust | Java | Go | Python;<br>SUPPORTS_OOP = Python | Java | JavaScript | Ruby;<br>MEMORY_SAFE = Python | JavaScript | Java | Rust | Ruby | Go;</div>
			<p style="margin-top: 0.75rem; color: #6b7280;">
				The DSL parser extracts categories (columns) and items (rows) automatically.
				Items can appear in multiple categories, creating the answer key for grading.
			</p>
		</div>

		<div class="features">
			<div class="feature-card">
				<label>Change Accent Color</label>
				<input type="color" id="colorPicker" value="#667eea">
			</div>
			<div class="feature-card">
				<label>Change Variant</label>
				<select id="variantPicker">
					<option>outline</option>
					<option>elegant</option>
					<option>playful</option>
					<option>letter</option>
					<option>sign</option>
					<option>minimal</option>
					<option>glass</option>
					<option>empty</option>
				</select>
			</div>
		</div>
	</div>

	<script type="module">
		import { ClassificationMatrix, basicTableDataParser, basicTableDataValidator } from './app.js';

		// DSL code for classification matrix
		const dslCode = `
INTERPRETED = Python | JavaScript | Ruby;
COMPILED = Rust | C | Go | Java;
STRONGLY_TYPED = Rust | Java | Go | Python;
SUPPORTS_OOP = Python | Java | JavaScript | Ruby;
MEMORY_SAFE = Python | JavaScript | Java | Rust | Ruby | Go;
		`.trim();

		// Parse DSL code
		const parseResult = basicTableDataParser(dslCode);

		if (parseResult.errors) {
			console.error('Parsing errors:', parseResult.errors);
			alert('Failed to parse DSL code. Check console for details.');
			throw new Error('Parser failed');
		}

		console.log('Parsed data:', parseResult.data);

		// Validate parsed data
		const validationResult = basicTableDataValidator(parseResult.data, 'classification');

		if (!validationResult.ok) {
			console.error('Validation errors:', validationResult.errors);
			alert('Data validation failed. Check console for details.');
			throw new Error('Validation failed');
		}

		console.log('âœ… Data validated successfully!');

		// Configuration for the interaction
		const config = {
			variant: 'elegant',
			prompt: 'Which programming languages have these features?',
			headerEnabled: false,
			autoCheckButton: false,
			footerEnabled: true,
			footerAction: 'check',
			stimulus: 'text',
			counterEnabled: true,
			animationsEnabled: true,
			timer: 0, // No timer
			retries: 0,
			construct: 'Programming Language Features',
			shuffle: false
		};

		// Mount point
		const mount = document.getElementById('quiz-mount');

		// Handler for when the quiz is submitted
		const interactionHandler = (result) => {
			console.log('Quiz completed with result:', result);
			alert(`Quiz complete! Check the console for detailed results.`);
		};

		// Create and initialize the interaction
		const quiz = new ClassificationMatrix({
			mount: mount,
			data: parseResult.data,
			config: config,
			interactionHandler: interactionHandler
		});

		// Variant picker
		const variantPicker = document.getElementById("variantPicker");
		variantPicker.addEventListener("change", (e) => {
			const val = e.target.value;
			quiz.setVariant(val);
		});

		// Color picker
		const picker = document.getElementById("colorPicker");
		picker.addEventListener("change", (e) => {
			const hex = e.target.value;

			const r = parseInt(hex.substring(1, 3), 16);
			const g = parseInt(hex.substring(3, 5), 16);
			const b = parseInt(hex.substring(5, 7), 16);

			quiz.shell.style.setProperty('--edu-first-accent', `${r} ${g} ${b}`);
		});

		console.log('ClassificationMatrix initialized:', quiz);
		console.log('Answer key:', parseResult.data.answerKey);
	</script>
</body>
</html>
